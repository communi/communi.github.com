<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Communi: QML bot example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://communi.github.com"><img alt="Logo" src="communi.png"/></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Communi
   &#160;<span id="projectnumber">3.2.0</span>
   </div>
   <div id="projectbrief">A cross-platform IRC framework written with Qt</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">QML bot example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The QML bot example is a simplified version of the <a class="el" href="bot.html">bot example</a>, written in QML. See the <a class="el" href="qml.html">QML compatibility</a> article for more QML specific details.</p>
<div class="image">
<img src="qmlbot.png" alt="qmlbot.png"/>
<div class="caption">
The QML bot example in action</div></div>
<p> The following snippet illustrates how <a class="el" href="class_irc_connection.html" title="Provides means to establish a connection to an IRC server. ">IrcConnection</a> is prepared and opened, and how a command is queued to automatically join a channel when connected.</p>
<div class="fragment"><div class="line">        connection: <a class="code" href="class_irc_connection.html">IrcConnection</a> {</div>
<div class="line">            <span class="keywordtype">id</span>: connection</div>
<div class="line"></div>
<div class="line">            host: <span class="stringliteral">&quot;irc.freenode.net&quot;</span></div>
<div class="line">            userName: <span class="stringliteral">&quot;communi&quot;</span></div>
<div class="line">            nickName: <span class="stringliteral">&quot;QmlBot&quot;</span> + Math.round(Math.random() * 9999)</div>
<div class="line">            realName: qsTr(<span class="stringliteral">&quot;Communi %1 QML bot example&quot;</span>).arg(irc.version())</div>
<div class="line"></div>
<div class="line">            Component.onCompleted: {</div>
<div class="line">                <span class="comment">// queue a command to automatically join a channel when connected</span></div>
<div class="line">                sendCommand(command.createJoin(channel))</div>
<div class="line">                open()</div>
<div class="line">            }</div>
</div><!-- fragment --><p> The example utilizes <a class="el" href="class_irc_command_parser.html" title="Parses commands from user input. ">IrcCommandParser</a> for parsing commands from messages received from other clients. In order to take the parser in use, the supported commands must be teached, as illustrated below. Some of the commands are context sensitive, and the parser must be therefore kept aware of the list of channels the bot is on. This is easily achieved by binding the <a class="el" href="class_irc_command_parser.html#a410186d2e35df7538d7c494cf78b8650">IrcCommandParser::channels</a> property to the value of the <a class="el" href="class_irc_buffer_model.html#ae57b865c70fad588cfa152447d511ddc">IrcBufferModel::channels</a> property. Furthermore, like a typical IRC bot, the commands are triggered using a slightly different syntax in queries and channels.</p>
<div class="fragment"><div class="line">    <span class="keyword">property</span> IrcCommandParser parser: IrcCommandParser {</div>
<div class="line">        <span class="keywordtype">id</span>: parser</div>
<div class="line"></div>
<div class="line">        <span class="comment">// keep the parser aware of the context</span></div>
<div class="line">        channels: model.channels</div>
<div class="line"></div>
<div class="line">        <span class="comment">// - on channel, respond to: &quot;!&lt;command&gt; &lt;params&gt;&quot; and &quot;bot: &lt;command&gt; &lt;params&gt;&quot;</span></div>
<div class="line">        <span class="comment">// - in query, respond to: &quot;!&lt;command&gt; &lt;params&gt;&quot; and &quot;&lt;command&gt; &lt;params&gt;&quot;</span></div>
<div class="line">        triggers: connection.network.isChannel(target) ? [<span class="stringliteral">&quot;!&quot;</span>, connection.nickName + <span class="stringliteral">&quot;:&quot;</span>] : [<span class="stringliteral">&quot;!&quot;</span>, <span class="stringliteral">&quot;&quot;</span>]</div>
<div class="line"></div>
<div class="line">        Component.onCompleted: {</div>
<div class="line">            <span class="comment">// teach the bot some commands</span></div>
<div class="line">            parser.addCommand(<a class="code" href="class_irc_command.html">IrcCommand</a>.<a class="code" href="class_irc_command.html#aa372efb107a86cec49b7587210132325a154da08807dc12eac2b1dd0d1c170bd5">Nick</a>, <span class="stringliteral">&quot;NICK &lt;nick&gt;&quot;</span>);</div>
<div class="line">            parser.addCommand(<a class="code" href="class_irc_command.html">IrcCommand</a>.<a class="code" href="class_irc_command.html#aa372efb107a86cec49b7587210132325a9633cce712489c7906872fbfb3969493">Join</a>, <span class="stringliteral">&quot;JOIN &lt;#channel&gt; (&lt;key&gt;)&quot;</span>);</div>
<div class="line">            parser.addCommand(<a class="code" href="class_irc_command.html">IrcCommand</a>.<a class="code" href="class_irc_command.html#aa372efb107a86cec49b7587210132325a2b6e8db583625d114ae748598f769432">Part</a>, <span class="stringliteral">&quot;PART (&lt;#channel&gt;) (&lt;message...&gt;)&quot;</span>);</div>
<div class="line">            parser.addCommand(<a class="code" href="class_irc_command.html">IrcCommand</a>.<a class="code" href="class_irc_command.html#aa372efb107a86cec49b7587210132325af37dfc46bf36c172b8eb215fdb7f69a7">Quit</a>, <span class="stringliteral">&quot;QUIT (&lt;message...&gt;)&quot;</span>);</div>
<div class="line">            parser.addCommand(<a class="code" href="class_irc_command.html">IrcCommand</a>.<a class="code" href="class_irc_command.html#aa372efb107a86cec49b7587210132325a4c4322cd41986d56420c46e80d3accb2">Message</a>, <span class="stringliteral">&quot;SAY [target] &lt;message...&gt;&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --><p> The bot listens to incoming messages via <a class="el" href="class_irc_connection.html#a621c4c16a74639e9f358bd2ef0f5bccd">IrcConnection::messageReceived()</a>. The current target is chosen based on whether the incoming message is a channel or a private message. Each message content is parsed for commands that were taught earlier.</p>
<div class="fragment"><div class="line">            onMessageReceived: {</div>
<div class="line">                <span class="keywordflow">if</span> (message.<a class="code" href="class_irc_message.html#aa021c38da6e1eef68e8044000f79f7aa">type</a> === <a class="code" href="class_irc_message.html">IrcMessage</a>.<a class="code" href="class_irc_message.html#a9b859b3a8d24f1a959073ce015460cbeaaf0f4b4adb7b851d0c7f64c3303b75f8">Private</a>) {</div>
<div class="line">                    <span class="comment">// - in private, reply to the message sender</span></div>
<div class="line">                    <span class="comment">// - on channel, reply to the target channel</span></div>
<div class="line">                    parser.target = message.<a class="code" href="class_irc_private_message.html#addc071083b4b5b1c1c565eb2384db24a">private</a> ? message.<a class="code" href="class_irc_message.html#a9108f9aa72e92e55b6408d965a9ca884">nick</a> : message.<a class="code" href="class_irc_private_message.html#a46a78c181362dada7b5e9ae9110b438a">target</a></div>
<div class="line"></div>
<div class="line">                    var command = parser.parse(message.<a class="code" href="class_irc_private_message.html#add5452fc60fa409bc4005730683a5cdf">content</a>)</div>
<div class="line">                    <span class="keywordflow">if</span> (command) {</div>
<div class="line">                        <span class="comment">// send the command to the IRC server</span></div>
<div class="line">                        sendCommand(command)</div>
<div class="line">                        if (command.type === <a class="code" href="class_irc_command.html">IrcCommand</a>.Quit) {</div>
<div class="line">                            <span class="comment">// close the connection &amp; quit the app when a !quit command was received</span></div>
<div class="line">                            close()</div>
<div class="line">                            Qt.quit()</div>
<div class="line">                        }</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
</div><!-- fragment --><p> Files: </p><ul>
<li><a class="el" href="qmlbot_2main_8cpp.html">examples/qmlbot/main.cpp</a> </li>
<li><a class="el" href="qmlbot_2qml_2main_8qml.html">examples/qmlbot/qml/main.qml</a> </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Aug 9 2014 19:53:46 for Communi by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
